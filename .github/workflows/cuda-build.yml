name: CUDA Build

on:
  push:
    branches:
      - V2.0  # Change to your default branch name
  pull_request:
    branches:
      - V2.0  # Change to your default branch name
  release:
    types: [created]  # Trigger on release creation

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v2

    - name: Install CUDA
      run: |
        # Download CUDA 12.6.2 full installer
        curl -O https://developer.download.nvidia.com/compute/cuda/12.6.2/local_installers/cuda_12.6.2_560.94_windows.exe
        
        # Install CUDA using PowerShell with nvcc argument
        Start-Process -FilePath "cuda_12.6.2_560.94_windows.exe" -ArgumentList "-s nvcc_12.6" -Wait -NoNewWindow

    - name: Build with MSBuild
      run: |
        # Restore NuGet packages if needed (uncomment if you use NuGet)
        # nuget restore BruteForceMnemonicCUDA.sln
        
        # Build the solution
        msbuild BruteForceMnemonicCUDA.sln /p:Configuration=Release

    - name: Create Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        tag: ${{ github.ref }}
        files: x64/Release/BruteForceMnemonicBitcoinV200.exe  # Specify the correct path to your executable
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
