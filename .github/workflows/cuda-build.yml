name: CUDA Build

on:
  push:
    branches:
      - V2.0  # Change to your default branch name
  pull_request:
    branches:
      - V2.0  # Change to your default branch name
  release:
    types: [created]  # Trigger on release creation

jobs:
  build-windows:
    runs-on: windows-latest  # Use the latest Windows runner

    steps:
    - name: Check out code
      uses: actions/checkout@v2

    - name: Install Visual Studio Build Tools 2022
      run: |
        # Install Visual Studio Build Tools 2022 with MSBuild
        choco install visualstudio2022buildtools --installargs '--add Microsoft.VisualStudio.Workload.VCTools'

    - name: Install CUDA Toolkit
      run: |
        # Install CUDA toolkit 12.6.2 using Chocolatey
        choco install cuda --version=12.6.2

    - name: Verify CUDA Installation
      run: |
        # Check the installed CUDA compiler version
        nvcc --version

    - name: Build with MSBuild
      run: |
        # Build the solution using the installed MSBuild
        & "C:\Program Files\Microsoft Visual Studio\2022\BuildTools\MSBuild\Current\Bin\MSBuild.exe" BruteForceMnemonicCUDA.sln /p:Configuration=Release

    - name: Create Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        tag: ${{ github.ref }}
        files: x64/Release/BruteForceMnemonicBitcoinV200.exe  # Specify the correct path to your executable
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
